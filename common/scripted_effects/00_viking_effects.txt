setup_flip_to_colonial_culture = {
	#to
	if = {
		limit = {
			can_country_flip_to_colonial_culture = {
				to = $to$
			}
		}
		random_owned_province = {
			limit = {
				can_province_flip_to_colonial_culture = {
					to = $to$
				}
			}
			save_event_target_as = flip_to_$to$
		}
	}
}

flip_to_colonial_culture = {
	#to
	if = {
		limit = {
			NOT = {
				primary_culture = $to$
			}
		}
		change_primary_culture = $to$
	}
	event_target:flip_to_$to$ = {
		region = {
			limit = {
				owned_by = ROOT
				is_culture_to_$to$ = {
					cond = culture
				}
			}
			change_culture = $to$
		}
	}
	set_country_flag = embraced_new_colonial_culture
}

accept_to_colonial_culture = {
	#to
	if = {
		limit = {
			NOT = {
				primary_culture = $to$
			}
		}
		add_accepted_culture = $to$
	}
	event_target:flip_to_$to$ = {
		region = {
			limit = {
				owned_by = ROOT
				is_culture_to_$to$ = {
					cond = culture
				}
			}
			change_culture = $to$
		}
	}
	set_country_flag = accepted_new_colonial_culture
}

refuse_colonial_culture = {
	#to
	event_target:flip_to_$to$ = {
		change_culture = $to$
	}
	set_country_flag = rejected_new_colonial_culture
}

add_legitimacy_equivalent = {
	add_legitimacy = $value$
	add_republican_tradition = $value$
	add_horde_unity = $value$
	add_devotion = $value$
	add_meritocracy = $value$
}

# province scope
## add manufactory in scope
### build_possible_manufactory_in_province = yes
build_possible_manufactory_in_province = {
	custom_tooltip = BUILD_MATCHING_MANUFACTORY_IN_THIS_PROVINCE
	hidden_effect = {
		if = {
			limit = {
				has_no_manufactory_trigger = yes
			}
			if = {
				limit = {
					OR = {
						trade_goods = naval_supplies
						trade_goods = fish
						trade_goods = salt
					}
				}
				if = {
					limit = {
						ROOT = {
							dip_tech = 11
						}
					}
					add_building = wharf
				}
				else = {
					ROOT = {
						add_dip_power = 20
					}
				}
			}
			else_if = {
				limit = {
					OR = {
						trade_goods = copper
						trade_goods = iron
					}
				}
				if = {
					limit = {
						ROOT = {
							mil_tech = 11
						}
					}
					add_building = weapons
				}
				else = {
					ROOT = {
						add_mil_power = 20
					}
				}
			}
			else_if = {
				limit = {
					OR = {
						trade_goods = wool
						trade_goods = cloth
						trade_goods = silk
						trade_goods = dyes
					}
				}
				if = {
					limit = {
						ROOT = {
							adm_tech = 11
						}
					}
					add_building = textile
				}
				else = {
					ROOT = {
						add_adm_power = 20
					}
				}
			}
			else_if = {
				limit = {
					OR = {
						trade_goods = coffee
						trade_goods = cotton
						trade_goods = sugar
						trade_goods = tobacco
						trade_goods = tea
						trade_goods = cocoa
					}
				}
				if = {
					limit = {
						ROOT = {
							adm_tech = 14
						}
					}
					add_building = plantations
				}
				else = {
					ROOT = {
						add_adm_power = 20
					}
				}
			}
			else_if = {
				limit = {
					OR = {
						trade_goods = ivory
						trade_goods = slaves
						trade_goods = spices
						trade_goods = fur
						trade_goods = incense
					}
				}
				if = {
					limit = {
						ROOT = {
							dip_tech = 14
						}
					}
					add_building = tradecompany
				}
				else = {
					ROOT = {
						add_dip_power = 20
					}
				}
			}
			else_if = {
				limit = {
					OR = {
						trade_goods = grain
						trade_goods = livestock
						trade_goods = wine
					}
				}
				if = {
					limit = {
						ROOT = {
							adm_tech = 6
						}
					}
					add_building = farm_estate
				}
				else = {
					ROOT = {
						add_adm_power = 20
					}
				}
			}
			else_if = {
				limit = {
					OR = {
						trade_goods = paper
						trade_goods = gems
						trade_goods = tropical_wood
						trade_goods = glass
						trade_goods = chinaware
					}
				}
				if = {
					limit = {
						ROOT = {
							adm_tech = 16
						}
					}
					add_building = mills
				}
				else = {
					ROOT = {
						add_adm_power = 20
					}
				}
			}
			else_if = {
				limit = {
					has_dlc = "Rule Britannia"
					trade_goods = coal
				}
				if = {
					limit = {
						ROOT = {
							adm_tech = 21
						}
					}
					add_building = furnace
				}
				else = {
					ROOT = {
						add_adm_power = 20
					}
				}
			}
			else = {
				add_base_tax = 1
				add_base_production = 1
				add_base_manpower = 1
			}
		}
		else = {
			add_base_tax = 1
			add_base_production = 1
			add_base_manpower = 1
		}
	}
}

## create or add a CoT
### create_or_add_center_of_trade_level = { level = <number> }
create_or_add_center_of_trade_level = {
	if = {
		limit = {
			variable_arithmetic_trigger = {
				export_to_variable = {
					which = var
					value = $level$
				}
				check_variable = {
					which = var
					value = 1
				}
			}
		}
		if = {
			limit = {
				NOT = {
					province_has_center_of_trade_of_level = 1
				}
			}
			center_of_trade = $level$
		}
		else_if = {
			limit = {
				NOT = {
					province_has_center_of_trade_of_level = 2
				}
			}
			if = {
				limit = {
					variable_arithmetic_trigger = {
						export_to_variable = {
							which = var
							value = $level$
						}
						check_variable = {
							which = var
							value = 2
						}
					}
				}
				add_center_of_trade_level = 2
			}
			else = {
				add_center_of_trade_level = 1
			}
		}
		else_if = {
			limit = {
				NOT = {
					province_has_center_of_trade_of_level = 3
				}
			}
			add_center_of_trade_level = 1
		}
		else = {
			add_base_production = 2
		}
	}
	else_if = {
		limit = {
			variable_arithmetic_trigger = {
				export_to_variable = {
					which = var
					value = $level$
				}
				NOT = {
					check_variable = {
						which = var
						value = 0
					}
				}
			}
		}
		if = {
			limit = {
				province_has_center_of_trade_of_level = 3
			}
			if = {
				limit = {
					variable_arithmetic_trigger = {
						export_to_variable = {
							which = var
							value = $level$
						}
						check_variable = {
							which = var
							value = -1
						}
					}
				}
				add_center_of_trade_level = -1
			}
			else = {
				add_center_of_trade_level = -2
			}
		}
		else_if = {
			limit = {
				province_has_center_of_trade_of_level = 2
			}
			add_center_of_trade_level = -1
		}
	}
}

faction_in_power_effect = {
	if = {
		LIMIT = {
			FRA = {
				faction_in_power = faction_capet
			}
			NOT = {
				has_country_flag = capet_added_to_factions
			}
		}
		ROOT = {
			add_faction = faction_capet
			add_faction_influence = {
				faction = faction_capet
				influence = 33
			}
			set_country_flag = capet_added_to_factions
		}
	}
	else_if = {
		limit = {
			FRA = {
				faction_in_power = faction_carolingian
			}
			NOT = {
				has_country_flag = carolingians_added_to_factions
			}
		}
		ROOT = {
			add_faction = faction_carolingian
			add_faction_influence = {
				faction = faction_carolingian
				influence = 33
			}
			set_country_flag = carolingians_added_to_factions
		}
	}
	else_if = {
		limit = {
			FRA = {
				faction_in_power = faction_bourbon
			}
			NOT = {
				has_country_flag = bourbons_added_to_factions
			}
		}
		ROOT = {
			add_faction = faction_bourbon
			add_faction_influence = {
				faction = faction_bourbon
				influence = 33
			}
			set_country_flag = bourbons_added_to_factions
		}
	}
	else_if = {
		limit = {
			FRA = {
				faction_in_power = faction_valois
			}
			NOT = {
				has_country_flag = valois_added_to_factions
			}
		}
		ROOT = {
			add_faction = faction_valois
			add_faction_influence = {
				faction = faction_valois
				influence = 33
			}
			set_country_flag = valois_added_to_factions
		}
	}
	else_if = {
		LIMIT = {
			SPA = {
				faction_in_power = faction_jimenez
			}
			NOT = {
				has_country_flag = jimenez_added_to_factions
			}
		}
		ROOT = {
			add_faction = faction_jimenez
			add_faction_influence = {
				faction = faction_jimenez
				influence = 33
			}
			set_country_flag = jimenez_added_to_factions
		}
	}
	else_if = {
		limit = {
			SPA = {
				faction_in_power = faction_ivrea
			}
			NOT = {
				has_country_flag = ivrea_added_to_factions
			}
		}
		ROOT = {
			add_faction = faction_ivrea
			add_faction_influence = {
				faction = faction_ivrea
				influence = 33
			}
			set_country_flag = ivrea_added_to_factions
		}
	}
	else_if = {
		limit = {
			SPA = {
				faction_in_power = faction_trastamara
			}
			NOT = {
				has_country_flag = trastamara_added_to_factions
			}
		}
		ROOT = {
			add_faction = faction_trastamara
			add_faction_influence = {
				faction = faction_trastamara
				influence = 33
			}
			set_country_flag = trastamara_added_to_factions
		}
	}
	else_if = {
		limit = {
			ENG = {
				faction_in_power = faction_york
			}
			NOT = {
				has_country_flag = york_added_to_factions
			}
		}
		ROOT = {
			add_faction = faction_york
			add_faction_influence = {
				faction = faction_york
				influence = 33
			}
			set_country_flag = york_added_to_factions
		}
	}
	else_if = {
		limit = {
			ENG = {
				faction_in_power = faction_tudor
			}
			NOT = {
				has_country_flag = tudor_added_to_factions
			}
		}
		ROOT = {
			add_faction = faction_tudor
			add_faction_influence = {
				faction = faction_tudor
				influence = 33
			}
			set_country_flag = tudor
		}
	}
	else_if = {
		limit = {
			ENG = {
				faction_in_power = faction_lancaster
			}
			NOT = {
				has_country_flag = lancaster_added_to_factions
			}
		}
		ROOT = {
			add_faction = faction_lancaster
			add_faction_influence = {
				faction = faction_lancaster
				influence = 33
			}
			set_country_flag = lancaster_added_to_factions
		}
	}
	else_if = {
		limit = {
			GBR = {
				faction_in_power = faction_aberffraw
			}
			NOT = {
				has_country_flag = aberffraw_added_to_factions
			}
		}
		ROOT = {
			add_faction = faction_aberffraw
			add_faction_influence = {
				faction = faction_aberffraw
				influence = 33
			}
			set_country_flag = aberffraw_added_to_factions
		}
	}
	else_if = {
		limit = {
			GBR = {
				faction_in_power = faction_stuart
			}
			NOT = {
				has_country_flag = stuart_added_to_factions
			}
		}
		ROOT = {
			add_faction = faction_stuart
			add_faction_influence = {
				faction = faction_stuart
				influence = 33
			}
			set_country_flag = stuart_added_to_factions
		}
	}
	else_if = {
		limit = {
			GER = {
				faction_in_power = faction_vonluxembourg
			}
			NOT = {
				has_country_flag = vonluxembourg_added_to_factions
			}
		}
		ROOT = {
			add_faction = faction_vonluxembourg
			add_faction_influence = {
				faction = faction_vonluxembourg
				influence = 33
			}
			set_country_flag = vonluxembourg_added_to_factions
		}
	}
	else_if = {
		limit = {
			GER = {
				faction_in_power = faction_vonwittlesbach
			}
			NOT = {
				has_country_flag = vonwittlesbach_added_to_factions
			}
		}
		ROOT = {
			add_faction = faction_vonwittlesbach
			add_faction_influence = {
				faction = faction_vonwittlesbach
				influence = 33
			}
			set_country_flag = vonwittlesbach_added_to_factions
		}
	}
	else_if = {
		limit = {
			GER = {
				faction_in_power = faction_hohenzollern
			}
			NOT = {
				has_country_flag = hohenzollern_added_to_factions
			}
		}
		ROOT = {
			add_faction = faction_hohenzollern
			add_faction_influence = {
				faction = faction_hohenzollern
				influence = 33
			}
			set_country_flag = hohenzollern_added_to_factions
		}
	}
	else_if = {
		limit = {
			PRU = {
				faction_in_power = faction_vonluxembourg
			}
			NOT = {
				has_country_flag = vonluxembourg_added_to_factions
			}
		}
		ROOT = {
			add_faction = faction_vonluxembourg
			add_faction_influence = {
				faction = faction_vonluxembourg
				influence = 33
			}
			set_country_flag = vonluxembourg_added_to_factions
		}
	}
	else_if = {
		limit = {
			PRU = {
				faction_in_power = faction_vonwittlesbach
			}
			NOT = {
				has_country_flag = vonwittlesbach_added_to_factions
			}
		}
		ROOT = {
			add_faction = faction_vonwittlesbach
			add_faction_influence = {
				faction = faction_vonwittlesbach
				influence = 33
			}
			set_country_flag = vonwittlesbach_added_to_factions
		}
	}
	else_if = {
		limit = {
			PRU = {
				faction_in_power = faction_hohenzollern
			}
			NOT = {
				has_country_flag = hohenzollern_added_to_factions
			}
		}
		ROOT = {
			add_faction = faction_hohenzollern
			add_faction_influence = {
				faction = faction_hohenzollern
				influence = 33
			}
			set_country_flag = hohenzollern_added_to_factions
		}
	}
}

factions_join_court_effect = {
	ROOT = {
		if = {
			LIMIT = {
				SPA = {
					junior_union_with = ROOT
				}
				NOT = {
					has_spanish_factions = yes
				}
				NOT = {
					has_country_flag = spanish_factions_added_to_court
				}
			}
			SPA = {
				PREV = {
					add_accepted_culture = new_variable:PREV:primary_culture
				}
			}
			add_faction = faction_jimenez
			add_faction = faction_ivrea
			add_faction = faction_trastamara
			set_country_flag = spanish_factions_added_to_court
		}
		else_if = {
			LIMIT = {
				ENG = {
					junior_union_with = ROOT
				}
				NOT = {
					has_english_factions = yes
				}
				NOT = {
					has_country_flag = english_factions_added_to_court
				}
			}
			ENG = {
				PREV = {
					add_accepted_culture = new_variable:PREV:primary_culture
				}
			}
			add_faction = faction_tudor
			add_faction = faction_york
			add_faction = faction_lancaster
			set_country_flag = english_factions_added_to_court
		}
		else_if = {
			LIMIT = {
				GBR = {
					junior_union_with = ROOT
				}
				NOT = {
					has_british_factions = yes
				}
				NOT = {
					has_country_flag = british_factions_added_to_court
				}
			}
			GBR = {
				PREV = {
					add_accepted_culture = new_variable:PREV:primary_culture
				}
			}
			add_faction = faction_tudor
			add_faction = faction_stuart
			add_faction = faction_aberffraw
			set_country_flag = british_factions_added_to_court
		}
		else_if = {
			LIMIT = {
				FRA = {
					junior_union_with = ROOT
				}
				NOT = {
					has_french_factions_with_karlings = yes
				}
				NOT = {
					has_country_flag = french_factions_added_to_court
				}
			}
			FRA = {
				PREV = {
					add_accepted_culture = new_variable:PREV:primary_culture
				}
			}
			add_faction = faction_capet
			add_faction = faction_carolingian
			add_faction = faction_valois
			set_country_flag = french_factions_added_to_court
		}
		else_if = {
			LIMIT = {
				FRA = {
					junior_union_with = ROOT
				}
				NOT = {
					has_french_factions_with_bourbons = yes
				}
				NOT = {
					has_country_flag = french_factions_added_to_court
				}
			}
			FRA = {
				PREV = {
					add_accepted_culture = new_variable:PREV:primary_culture
				}
			}
			add_faction = faction_capet
			add_faction = faction_valois
			add_faction = faction_bourbon
			set_country_flag = french_factions_added_to_court
		}
		else_if = {
			LIMIT = {
				PRU = {
					junior_union_with = ROOT
				}
				NOT = {
					has_german_factions = yes
				}
				NOT = {
					has_country_flag = german_factions_added_to_court
				}
			}
			PRU = {
				PREV = {
					add_accepted_culture = new_variable:PREV:primary_culture
				}
			}
			add_faction = faction_vonluxembourg
			add_faction = faction_vonwittlesbach
			add_faction = faction_hohenzollern
			set_country_flag = german_factions_added_to_court
		}
		else_if = {
			LIMIT = {
				GER = {
					junior_union_with = ROOT
				}
				NOT = {
					has_german_factions = yes
				}
				NOT = {
					has_country_flag = german_factions_added_to_court
				}
			}
			GER = {
				PREV = {
					add_accepted_culture = new_variable:PREV:primary_culture
				}
			}
			add_faction = faction_vonluxembourg
			add_faction = faction_vonwittlesbach
			add_faction = faction_hohenzollern
			set_country_flag = german_factions_added_to_court
		}
	}
}
